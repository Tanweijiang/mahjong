#mahjong项目说明文档

这是一个麻将游戏的项目，项目目标是实现一套支持多用户在线玩麻将游戏。
麻将游戏有多种规则，本项目设计为可扩展架构，支持新创建规则。

##需求用例描述

####用户端

用户通过访问网页，进入游戏大厅。
用户通过输入一些信息连入单局服务器。
当连入单局服务器人数满足要求后，用户可以开始游戏。
用户游戏过程中有可能结束游戏，或者暂停游戏。
游戏结束后需要给用户显示积分。

####服务端

服务器需要控制游戏开始，结束。
牌局中需要支持：洗牌，抓牌（补花），出牌，吃，碰，杠，胡，算分
牌局间需要记：庄，圈（风），轮转
对于每个用户，需要记录：手牌，积分，门（风），补花

##服务器端

####接口

0. create
创建并开始一局游戏
> 输入：
	game_id,可选，如果不传则新建一局游戏，如果传了就在游戏上增加一个人
	user_id,必选，参加游戏的用户
	player_num,可选，默认4人，可以指定参与人数
> 逻辑：
	创建或者参加游戏的用户都是等待状态，用户可以调用开始接口来改变这个状态
> 输出：
	创建成功或者失败，若成功则返回game_id

1. start
开始一盘
> 输入：
	game_id,必选
	user_id,必选
> 逻辑：
	将用户状态置为开始或者等待，如果同一个game下人数达到指定数字，并且所有人都开始，则开始游戏
> 输出：
	成功或失败

2. get
抓牌，补花
> 输入：
	set_id,必选
	user_id,必选
> 逻辑：
	抓新的牌，可能是4个，可能是2个，也可能是1个
> 输出：
	抓到的牌数组

4. op
出牌，吃，碰，杠，胡
> 输入：
	set_id,必选
	user_id,必选
	cmd,必选，操作选项，chi,peng,gang,hu,pass,push
	card_index_list,必选，牌序列集合
> 逻辑：
	尝试执行指定操作，更新牌局信息
	如果有人胡牌，还要更新结算信息，同时更新房间选手状态改为等待开始状态
> 输出：
	成功或失败

5. set_info
> 输入：
	user_id,必选
> 逻辑：
	每一局之中不断变化
> 输出：
	手牌（打码），牌池，牌墙，有人胡牌，等待操作（op|get）

6. game_info
> 输入：
	user_id,必选
> 逻辑：
	每一局开始前不短变化
> 输出：
	参与选手，参与选手是否开始，参与选手信息，牌局信息（积分，圈风，门风，庄风，色子数）


####数据

0. 牌的定义
	 国标麻将共144张
	 > 1-9,11-19,21-29,31-39为萬牌
	 > 41-49,51-59,61-69,71-79为眼牌
	 > 81-89,91-99，101-109,111-119为条牌
	 > 121-127,131-137,141-147,151-157为字牌（东南西北中发白）
	 > 161-168为花牌（初夏秋冬，梅兰竹菊）
	 > 再有其他规则，200以后补加

1. 牌盘
2. 牌局
3. 用户

####逻辑

1. 牌面乱序
2. 牌面排序
3. 吃碰杠听胡监测
4. 数据创建
5. 数据更新
6. 算分
	国标算分：
	 >88番
	 >>1、大四喜：由4副风刻（杠）组成的和牌。不计圈风刻、门风刻、三风刻、碰碰和、幺九刻。
	 >>2、大三元：和牌中，有中发白3副刻子。不计双箭刻、箭刻。
	 >>3、绿一色：由23468条及发字中的任何牌组成的和牌。按新规定，无“发”时可计清一色、断幺，有“发”时可计混一色。
	 >>4、九莲宝灯：由一种花色序数牌按①①①②③④⑤⑥⑦⑧⑨⑨⑨组成的特定牌型，见同花色任何1张序数牌即成和牌。不计清一色、门前清、幺九刻，自摸计不求人。因听牌时听同花色所有9种牌而得名。如不是听九种牌的情况但和牌后牌型符合九莲宝灯牌型的，一般不算九莲宝灯，但有的场合也算(如QQ麻将)。
	 >>5、四杠：4个杠，因和牌时总共18张牌，又称“十八罗汉”。
	 >>6、连七对：由一种花色序数牌组成序数相连的7个对子的和牌。不计七对、清一色、不求人、单钓。
	 >>7、十三幺：由3种序数牌的一、九牌，7种字牌及其中一对作将组成的和牌。不计五门齐、门前清、单钓，自摸加计不求人。又称“国士无双”。

	 >64番
	 >>8、清幺九：由序数牌一、九组成的和牌。不计碰碰和、全带幺、幺九刻、无字。可计七对、两组双同刻或一组三同刻。又称“清老头”。
	 >>9、小四喜：和牌时有风牌的3副刻子及将牌。不计三风刻。
	 >>10、小三元：和牌时有箭牌的两副刻子和将牌。不计箭刻。
	 >>11、字一色：由字牌组成的和牌。不计碰碰和，可计七对。
	 >>12、四暗刻：4个暗刻（暗杠）。不计门前清、碰碰和。
	 >>13、一色双龙会：一种花色的两个老少副，5为将牌。不计平和、七对、清一色。

	 >48番
	 >>14、一色四同顺：一种花色4副序数相同的顺子，不计三杠、一色三节高、一般高、四归一。
	 >>15、一色四节高：一种花色4副依次递增一位数的刻子，不计一色三同顺、碰碰和。

	 >32番
	 >>16、一色四步高：一种花色4副依次递增一位数或依次递增二位数的顺子。
	 >>17、三杠：整副牌中有3个杠子。
	 >>18、混幺九：由字牌和序数牌一、九组成的和牌。不计碰碰和。可计七对。又称“混老头”。

	 >24番
	 >>19、七对：由7个对子组成的和牌。不计门前清、单钓，自摸计不求人。又称“七对子”“七小对”等。
	 >>20、七星不靠：必须有7个单张的东西南北中发白，加上3种花色，数位按147、258、369中的7张序数牌组成没有将牌的和牌。不计五门齐、门前清、单钓。
	 >>21、全双刻：由2、4、6、8序数牌的刻子、将牌组成的和牌。不计碰碰和、断幺。
	 >>22、清一色：由一种花色的序数牌组成的和牌。不计无字。
	 >>23、一色三同顺：和牌时有一种花色3副序数相同的顺子。不计一色三节高。
	 >>24、一色三节高：和牌时有一种花色3副依次递增一位数字的刻子。不计一色三同顺。
	 >>25、全大：由序数牌789组成的顺子、刻子（杠）、将牌的和牌。不计无字。
	 >>26、全中：由序数牌456组成的顺子、刻子（杠）、将牌的和牌。不计断幺。
	 >>27、全小：由序数牌123组成的顺子、刻子（杠）、将牌的和牌。不计无字。

	 >16番
	 >>28、清龙：和牌时，有一种花1-9相连接的序数牌。又称“一条龙”“一气通贯”等。
	 >>29、三色双龙会：2种花色2个老少副、另一种花色5作将的和牌。不计喜相逢、老少副、无字、平和。
	 >>30、一色三步高：和牌时，有一种花色3副依次递增一位或依次递增二位数字的顺子。
	 >>31、全带五：每副牌及将牌必须有5的序数牌。不计断幺。
	 >>32、三同刻：3个序数相同的刻子（杠）。
	 >>33、三暗刻：3个暗刻，如果满足“碰碰和”牌型，可同时计算。

	 >12番
	 >>34、全不靠：由单张3种花色147、258、369不能错位的序数牌及东南西北中发白中的任何14张牌组成的和牌。不计五门齐、门前清、单钓。若和牌时147 258 369都有，则加计组合龙。
	 >>35、组合龙：3种花色的147、258、369不能错位的序数牌。若和牌时另两组牌为顺子+将，可计平和。
	 >>36、大于五：由序数牌6-9的顺子、刻子、将牌组成的和牌。不计无字。
	 >>37、小于五：由序数牌1-4的顺子、刻子、将牌组成的和牌。不计无字。
	 >>38、三风刻：3个风刻。

	 >8番
	 >>39、花龙：3种花色的3副顺子连接成1-9的序数牌。
	 >>40、推不倒：由牌面图形没有上下区别的牌组成的和牌，包括1234589饼、245689条、白板。不计缺一门。
	 >>41、三色三同顺：和牌时，有3种花色3副序数相同的顺子。
	 >>42、三色三节高：和牌时，有3种花色3副依次递增一位数的刻子。
	 >>43、无番和：和牌后，数不出任何番种分（花牌不计算在内）。
	 >>44、妙手回春：自摸牌墙上最后一张牌和牌。不计自摸。
	 >>45、海底捞月：和打出的最后一张牌。
	 >>46、杠上开花：开杠抓进的牌成和牌（不包括补花）。不计自摸。
	 >>47、抢杠和：和别人自抓开明杠的牌。不计和绝张。

	 >6番
	 >>48、碰碰和：由4副刻子（或杠）、将牌组成的和牌。又称“对对和(胡)”
	 >>49、混一色：由一种花色序数牌及字牌组成的和牌。
	 >>50、三色三步高：3种花色3副依次递增一位序数的顺子。
	 >>51、五门齐：和牌时3种序数牌、风、箭牌齐全。
	 >>52、全求人：全靠吃牌、碰牌、单钓别人打出的牌和牌。不计单钓。
	 >>53、双暗杠：2个暗杠。
	 >>54、双箭刻：2副箭刻（或杠）。

	 >4番
	 >>55、全带幺：和牌时，每副牌、将牌都有幺牌。
	 >>56、不求人：4副牌及将中没有吃牌、碰牌（包括明杠），所有的牌包括所和的牌全部是自己摸到的。又称“门清自摸”。
	 >>57、双明杠：2个明杠。
	 >>58、和绝张：和牌池、桌面已亮明的3张牌所剩的第4张牌（抢杠和不计和绝张）。

	 >2番
	 >>59、箭刻：由中、发、白3张相同的牌组成的刻子。
	 >>60、圈风刻：与圈风相同的风刻。
	 >>61、门风刻：与本门风相同的风刻。
	 >>62、门前清：没有吃、碰、明杠而听牌，和别人打出的牌。又称“门清”。
	 >>63、平和：由4副顺子及序数牌作将组成的和牌，边、坎、钓不影响平和。
	 >>64、四归一：和牌中，有4张相同的牌归于一家的顺子、刻子、对子、将牌中（不包括杠牌）。
	 >>65、双同刻：2副序数相同的刻子。
	 >>66、双暗刻：2个暗刻。
	 >>67、暗杠：自抓4张相同的牌开杠。
	 >>68、断幺：和牌中没有一、九及字牌。

	 >1番
	 >>69、一般高：由一种花色2副相同的顺子组成的牌。又称“一色二顺”“一杯口”。
	 >>70、喜相逢：2种花色2副序数相同的顺子。
	 >>71、连六：一种花色6张相连接的序数牌。
	 >>72、老少副：一种花色牌的123、789两副顺子。
	 >>73、幺九刻：3张相同的一、九序数牌及字牌组成的刻子（或杠）。
	 >>74、明杠：自己有暗刻，碰别人打出的一张相同的牌开杠；或自己抓进一张与碰的明刻相同的牌开杠。
	 >>75、缺一门：和牌中缺少一种花色序数牌。
	 >>76、无字：和牌中没有风、箭牌。
	 >>77、边张：单和123的3及789的7或1233和3、7789和7都为边张。手中有12345和3，56789和7不算和边张。
	 >>78、坎张：和2张牌之间的牌。4556和5也为坎张，手中有45567和6不算坎张。
	 >>79、单钓将：钓单张牌作将成和。
	 >>80、自摸：自己抓进牌成和牌。
	 >>81、花牌：即春夏秋冬，梅兰竹菊，每花计一分。不计在起和分内，和牌后才能计分。花牌补花成和计自摸分，不计杠上开花。

##客户端

####视图

0. 静态信息（积分，圈风，门风，庄风，色子数）
1. 手牌：显示，选择
2. 牌池：显示
3. 牌墙：显示
4. 操作：出牌，吃，碰，杠，胡
5. 胡牌界面（算分，开始下一盘）

6. 游戏大厅，创建并开始一局
7. 游戏房间，开始一盘

####交互

1. 游戏大厅，请求create接口，进入游戏房间
	action('create', {
		data:{
			game_id:
			user_id:
		},
		success:function(){
			enter room
			show start or waitting button
			refresh game info (request game_info)
		}
	});
2. 游戏房间，请求start接口，开始游戏
	action('start', {
		data:{
			game_id:
			user_id:
		},
		success:function(){
			do nothing
		}
	});
3. 每一局开始前，请求game_info接口，刷新选手信息
	action('game_info', {
		data:{
			game_id:
		},
		success:function(){
			show game info
			show player info

			if start
				refresh set info (request set_info)
			else
				refresh game info (request game_info)
		}
	});
4. 新的一局开始后，请求set_info接口，更新牌局状态
	action('set_info', {
		data:{
			set_id:
			user_id:
		},
		success:function(){
			show set info
			show play info

			if waiting for selt
				show cry option pannel and do sth (request cry)
			else if waiting for get
				get (request get)
			else if finish
				show win info
				refresh game info (request game_info)
			else
				refresh set info (request set_info)
		}
	});

5. 游戏中，根据游戏状态信息中的信号，请求get接口
	action('get', {
		data: {
			set_id:
			user_id:
		},
		success:function(){
			if success
				refresh set info (request set_info)
			else
				repeat or show offline
		}
	});
6. 游戏中，根据游戏状态信息中的信号，激活操作视图，并根据用户操作，请求cry接口
	action('op', {
		data: {
			set_id:
			user_id:
			cmd:
			card_index_list:
		},
		success:function(){
			if success
				refresh set info (request set_info)
			else
				repeat or show offline
		}
	})

####素材
1. 应用logo

	> 28*28 png <300k 微信应用授权
	> 108*108 png <300k 微信应用授权
	> 32*32 ico 网站favicon
	> 64*64 ico 网站favicon
2. 页面设计

	> 
